---
title: "Untitled"
author: "Ariel Marcy"
date: "12/3/2020"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("~/Documents/Work/Science/Research/2020 UNL DBER/Co-Teaching")
```

## Read in data and packages
```{r}
library(stringr)

raw <- read.csv("SurveyDataDI.csv", header = TRUE)
```

## Fix Academic Rank to ascend with rank
```{r}
t.data <- raw
t.data$AcadRank <- t.data$AcadRank * 10  # mark old numbers

# Sub in new ones
t.data$AcadRank[which(t.data$AcadRank == 10)] <- 6  # Prof
t.data$AcadRank[which(t.data$AcadRank == 20)] <- 5  # A/Prof
t.data$AcadRank[which(t.data$AcadRank == 30)] <- 4  # Asst P
t.data$AcadRank[which(t.data$AcadRank == 40)] <- 3  # lecturer
t.data$AcadRank[which(t.data$AcadRank == 50)] <- 2  # visiting
t.data$AcadRank[which(t.data$AcadRank == 60)] <- 1  # pre-prof (post-doc)
t.data$AcadRank[which(t.data$AcadRank == 70)] <- 1  # pre-prof (grad student)

rank.names <- c("PreProf", "Visit.", "Lecture", "Asst. P", "A/Prof", "Prof")

t.data$CoordPattern <- as.character(raw$CoordPattern) 
```

## Redefine "Coordination Pattern" into 3x4 table of broader categories
```{r}
u.coords <- unique(t.data$CoordPattern) 

# Subset by discipline [optional]
t.data <- t.data[which(t.data$Discipline == 3), ]

# Subset the datasets
text.1 <- t.data[str_which(t.data$CoordPattern, "1[123][123][123]"), ]  # solo
text.2 <- t.data[str_which(t.data$CoordPattern, "2[123][123][123]"), ]  # coll
text.3 <- t.data[str_which(t.data$CoordPattern, "3[123][123][123]"), ]  # cont

exam.1 <- t.data[str_which(t.data$CoordPattern, "[123]1[123][123]"), ]  # solo
exam.2 <- t.data[str_which(t.data$CoordPattern, "[123]2[123][123]"), ]  # coll
exam.3 <- t.data[str_which(t.data$CoordPattern, "[123]3[123][123]"), ]  # cont

cont.1 <- t.data[str_which(t.data$CoordPattern, "[123][123]1[123]"), ]  # solo
cont.2 <- t.data[str_which(t.data$CoordPattern, "[123][123]2[123]"), ]  # coll
cont.3 <- t.data[str_which(t.data$CoordPattern, "[123][123]3[123]"), ]  # cont

inst.1 <- t.data[str_which(t.data$CoordPattern, "[123][123][123]1"), ]  # solo
inst.2 <- t.data[str_which(t.data$CoordPattern, "[123][123][123]2"), ]  # coll
inst.3 <- t.data[str_which(t.data$CoordPattern, "[123][123][123]3"), ]  # cont
```

## Function to get important values by dataset
```{r}
MakeTECItable <- function(dataset) {
        # Get total n
        dataset <- dataset[complete.cases(dataset$RBISuse), ]
        N <- dim(dataset)[1]
        
        # Get percent RBIS
        perRBIS <- signif(((length(which(dataset$RBISuse == 2)) / N ) *100), 3)
        
        # Get the top three coordination patterns
        pat.freq <- table(dataset$CoordPattern)
        top.3 <- dimnames(pat.freq[order(pat.freq, decreasing = T)])[[1]][1:3]
        top.3.n <- pat.freq[order(pat.freq, decreasing = TRUE)[1:3]]
        top.3.eng <- paste(top.3[1], " (n=", top.3.n[1], "), ", top.3[2], " (n=", top.3.n[2], "), ", top.3[3], " (n=", top.3.n[3], ")", sep = "")
        TECIbox <- list(N, perRBIS, top.3.eng)
        return(TECIbox)        
        
}

# Print results for rough draft table
MakeTECItable(inst.3)
MakeTECItable(inst.2)
MakeTECItable(inst.1)
```


